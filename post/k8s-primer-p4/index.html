<!doctype html><html lang>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Kubernetes: Core Concepts Primer - Part 4 | </title>
<link rel=canonical href=/post/k8s-primer-p4/>
<meta name=description content="Software Engineer | Go | Microservices | Docker | Kubernetes | Avid Reader">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Kubernetes: Core Concepts Primer - Part 4">
<meta property="og:description" content="Kubernetes: Core Concepts Primer - Part 4 Security Context in Kubernetes Whenever it comes to security, always follow the The principle of least privilege (PlP) principle which states that a subject should be given only those privileges needed for it to complete its task.
Applying the same principle to kubernetes objects, we should grant a user the privileges needed to perform a task. Thats all, nothing more or nothing less. Giving root permissions to containers is not recommended.">
<meta property="og:type" content="article">
<meta property="og:url" content="/post/k8s-primer-p4/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-08-07T09:42:31+05:30">
<meta property="article:modified_time" content="2021-08-07T09:42:31+05:30">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Kubernetes: Core Concepts Primer - Part 4">
<meta name=twitter:description content="Kubernetes: Core Concepts Primer - Part 4 Security Context in Kubernetes Whenever it comes to security, always follow the The principle of least privilege (PlP) principle which states that a subject should be given only those privileges needed for it to complete its task.
Applying the same principle to kubernetes objects, we should grant a user the privileges needed to perform a task. Thats all, nothing more or nothing less. Giving root permissions to containers is not recommended.">
<link rel=stylesheet href=/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<header id=header>
<a href>
<div id=logo style=background-image:url(https://golang.org/doc/gopher/favicon.svg)></div>
<div id=title>
<h1></h1>
</div>
</a>
<div id=nav>
<ul>
<li class=icon>
<a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a>
</li>
<li><a href=/>Home</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</div>
</header>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<div class=content itemprop=articleBody>
<h1 id=kubernetes-core-concepts-primer---part-4>Kubernetes: Core Concepts Primer - Part 4</h1>
<h2 id=security-context-in-kubernetes>Security Context in Kubernetes</h2>
<p>Whenever it comes to security, always follow the <code>The principle of least privilege</code> (PlP) principle which states that <strong>a subject should be given only those privileges needed for it to complete its task.</strong></p>
<p>Applying the same principle to kubernetes objects, we should grant a user the privileges needed to perform a task. Thats all, nothing more or nothing less. Giving root permissions to containers is not recommended.</p>
<h4 id=note-permissions-at-container-level-will-always-override-permisions-at-pod-level>NOTE: Permissions at container level will always override permisions at pod level</h4>
<ul>
<li>To set permissions container, use <code>securityContext</code> field in the container definition.</li>
<li>To set permissions pod, use <code>securityContext</code> field in the pod definition file.</li>
<li>Capabilities can be added only to the container which are container&rsquo;s user permission</li>
</ul>
<p>Example for pod level security context:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
<span style=color:#f92672>securityContext</span>:
    <span style=color:#f92672>runAsUser</span>: <span style=color:#ae81ff>&lt;USER_ID&gt;</span>
<span style=color:#f92672>spec</span>:
    <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
</code></pre></div><p>Example for container level security context:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
<span style=color:#f92672>spec</span>:
    <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
          <span style=color:#f92672>securityContext</span>:
            <span style=color:#f92672>runAsUser</span>: <span style=color:#ae81ff>&lt;USER_ID&gt;</span>
            <span style=color:#f92672>capbilities</span>:
                <span style=color:#f92672>add</span>: [<span style=color:#e6db74>&#34;SYS_ADMIN&#34;</span>]
</code></pre></div><h1 id=what-are-user--service-accounts>What are user & service accounts?</h1>
<blockquote>
<p>User Accounts are used by developers/adminstrators to perform some administrative tasks. Service accounts are used by applications to perform some tasks. For eg: Jenkins uses service accounts for deployment purposes.</p>
</blockquote>
<p>To create a service account, run <code>kubectl create serviceaccount &lt;SERVICE_ACCOUNT_NAME></code></p>
<p>Creating a service account creates a token as a secret, that should be used for authentication by the service.</p>
<p>To add service account in a pod, use <code>serviceAccount</code> field in the same level as <code>containers</code> definition.</p>
<h1 id=resource-requirements-in-pods>Resource requirements in Pods:</h1>
<blockquote>
<p>Resource requirements are a way to specify the amount of resources that a container needs. It is a container level configuration.</p>
</blockquote>
<p>In containers array in pod definition, you can specify the resource requirements.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>resources</span>:
    <span style=color:#f92672>requests</span>:
        <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>&lt;CPU_ALLOTED&gt;</span>
        <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>&lt;MEMORY_ALLOTED&gt;</span>
    <span style=color:#f92672>limits</span>:
        <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>&lt;CPU_LIMIT&gt;</span>
        <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>&lt;MEMORY_LIMIT&gt;</span>
</code></pre></div><p>Limits restricts resources extra resources to be used by the container. If a container tried to superceed the cpu limits, the system will kill it.</p>
<h3 id=create-default-resources-requirements>Create default resources requirements</h3>
<p>To default the resource requirements for a namespace, create a yaml file</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>LimitRange</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cpu-limit-range</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>limits</span>:
  - <span style=color:#f92672>default</span>:
      <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>1</span>
    <span style=color:#f92672>defaultRequest</span>:
      <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>0.5</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Container</span>
</code></pre></div><p>Then, run <code>kubectl apply -f &lt;LIMIT_RANGE_FILE> --namespace=&lt;NAMESPACE_TO_APPLY_TO></code></p>
<h3 id=what-are-k8s-cpu--memory-units>What are k8s CPU & Memory units?</h3>
<ul>
<li>
<p><strong>CPU</strong>:</p>
<p>CPU unit specifies the amount of CPU time that a container can use. Refer the following examples:</p>
<ul>
<li>Consider a container using 50m cpu resource. The unit suffix m stands for “thousandth of a core”, so this resources object specifies that the container process needs 50/1000 of a core (5%). Or 5% of a core.</li>
<li>Consider a container using 2000m cpu resource. In this case, requirement is 2000/1000, which is 2 cores. Instead of 2000m, we can just use integer value 2.</li>
</ul>
</li>
<li>
<p><strong>Memory</strong>:</p>
<p>Memory unit specifies the amount of memory that a container can use. It is always measured in bytes. Supported values are:</p>
<table>
<thead>
<tr>
<th style=text-align:center>Unit Name</th>
<th style=text-align:center>Memory Unit</th>
<th style=text-align:center>Memory Value(1 unit in bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>Kilobyte</td>
<td style=text-align:center>K</td>
<td style=text-align:center>1000</td>
</tr>
<tr>
<td style=text-align:center>Megabyte</td>
<td style=text-align:center>M</td>
<td style=text-align:center>1,000,000</td>
</tr>
<tr>
<td style=text-align:center>Gigabyte</td>
<td style=text-align:center>G</td>
<td style=text-align:center>1,000,000,000</td>
</tr>
<tr>
<td style=text-align:center>Kibibyte</td>
<td style=text-align:center>Ki</td>
<td style=text-align:center>1024</td>
</tr>
<tr>
<td style=text-align:center>Mebibyte</td>
<td style=text-align:center>Mi</td>
<td style=text-align:center>1,048,576</td>
</tr>
<tr>
<td style=text-align:center>Gibibyte</td>
<td style=text-align:center>Gi</td>
<td style=text-align:center>1,073,741,824</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id=continue-reading-kubernetes-core-concepts-primer---part-5k8s-primer-p5><strong>Continue reading</strong>: <a href=../k8s-primer-p5/>Kubernetes: Core Concepts Primer - Part 5</a></h2>
</div>
</article>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>