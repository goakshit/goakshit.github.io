<!doctype html><html lang>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Kubernetes: Core Concepts Primer - Part 5 | </title>
<link rel=canonical href=/post/k8s-primer-p5/>
<meta name=description content="Software Engineer | Go | Microservices | Docker | Kubernetes | Avid Reader">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Kubernetes: Core Concepts Primer - Part 5">
<meta property="og:description" content="Kubernetes: Core Concepts Primer - Part 5 What are taints and tolerances?  Taints are a mechanism to add restrictions to the scheduling of pods. Tolerance is a mechanism to allow pods to be scheduled on nodes with certain conditions.
 To taint a node, use kubectl taint nodes <NODE_NAME> <KEY>=<VALUE>:<TAINT_EFFECT>
There are three kinds of taint effects:
 NoSchedule: This taint indicates that the node should not be used by pods.">
<meta property="og:type" content="article">
<meta property="og:url" content="/post/k8s-primer-p5/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-08-14T09:30:22+05:30">
<meta property="article:modified_time" content="2021-08-14T09:30:22+05:30">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Kubernetes: Core Concepts Primer - Part 5">
<meta name=twitter:description content="Kubernetes: Core Concepts Primer - Part 5 What are taints and tolerances?  Taints are a mechanism to add restrictions to the scheduling of pods. Tolerance is a mechanism to allow pods to be scheduled on nodes with certain conditions.
 To taint a node, use kubectl taint nodes <NODE_NAME> <KEY>=<VALUE>:<TAINT_EFFECT>
There are three kinds of taint effects:
 NoSchedule: This taint indicates that the node should not be used by pods.">
<link rel=stylesheet href=/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<header id=header>
<a href>
<div id=logo style=background-image:url(https://golang.org/doc/gopher/favicon.svg)></div>
<div id=title>
<h1></h1>
</div>
</a>
<div id=nav>
<ul>
<li class=icon>
<a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a>
</li>
<li><a href=/>Home</a></li>
<li><a href=/thoughts>Thoughts</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</div>
</header>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<div class=content itemprop=articleBody>
<h1 id=kubernetes-core-concepts-primer---part-5>Kubernetes: Core Concepts Primer - Part 5</h1>
<h2 id=what-are-taints-and-tolerances>What are taints and tolerances?</h2>
<blockquote>
<p>Taints are a mechanism to add restrictions to the scheduling of pods. Tolerance is a mechanism to allow pods to be scheduled on nodes with certain conditions.</p>
</blockquote>
<p>To taint a node, use <code>kubectl taint nodes &lt;NODE_NAME> &lt;KEY>=&lt;VALUE>:&lt;TAINT_EFFECT></code></p>
<p>There are three kinds of taint effects:</p>
<ul>
<li><code>NoSchedule</code>: This taint indicates that the node should not be used by pods.</li>
<li><code>PreferNoSchedule</code>: This taint indicates that the node should not be used by pods, but it is not guaranteed.</li>
<li><code>NoExecute</code>: This taint indicates that the node should not be used by pods, and if there are existing pods that do not tolerate the taint, they will be terminated.</li>
</ul>
<p>Tolerations are added to the pod definition file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
<span style=color:#f92672>spec</span>:
    <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
    <span style=color:#75715e># All the values under tolerations have to encoded in double quotes</span>
    <span style=color:#f92672>tolerations</span>:
        <span style=color:#f92672>key</span>: <span style=color:#e6db74>&#34;&lt;KEY&gt;&#34;</span>
        <span style=color:#f92672>operator</span>: <span style=color:#e6db74>&#34;&lt;OPERATOR&gt;&#34;</span> <span style=color:#75715e># &lt;OPERATOR&gt; can be one of these: &#34;Equal&#34;, &#34;LessThan&#34;, &#34;LessThanOrEqual&#34;, &#34;GreaterThan&#34;, &#34;GreaterThanOrEqual&#34;, &#34;Exists&#34;, &#34;DoesNotExist&#34;, &#34;In&#34;, &#34;NotIn&#34;</span>
        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;&lt;VALUE&gt;&#34;</span>
        <span style=color:#f92672>effect</span>: <span style=color:#e6db74>&#34;&lt;TAINT_EFFECT&gt;&#34;</span> <span style=color:#75715e># &lt;TAINT_EFFECT&gt; can be one of these: &#34;NoSchedule&#34;, &#34;PreferNoSchedule&#34;, &#34;NoExecute&#34;</span>
</code></pre></div><p>To remove the taint, run <code>kubectl taint nodes &lt;NODE_NAME> &lt;TAINT_NAME>:&lt;TAINT_EFFECT></code></p>
<h2 id=what-is-node-selector>What is node selector?</h2>
<blockquote>
<p>NodeSelector is a label query over a set of nodes. The node that matches the label query is the one that will be used for scheduling pods.</p>
</blockquote>
<p>Let&rsquo;s understand that with an example, say we have a cluster with 2 nodes with 1gb & 2gb memory respectively. We have two pods(A & B), where A runs more resource heavy task. We want to schedule A on node with 2gb memory. We can do that by adding <code>nodeSelector</code> to the pod definition file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
<span style=color:#f92672>spec</span>:
    <span style=color:#f92672>containers</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
    <span style=color:#f92672>nodeSelector</span>:
        <span style=color:#f92672>size</span>: <span style=color:#ae81ff>&lt;NODE_LABEL&gt;</span>
</code></pre></div><p><strong>Note</strong>: Ensure that nodes are already labeled with the labels that you want to match. To create a label if its not there, use <code>kubectl label nodes &lt;NODE_NAME> &lt;LABEL_NAME>=&lt;LABEL_VALUE></code></p>
<h2 id=what-is-node-affinity>What is node affinity?</h2>
<blockquote>
<p>Node affinity is a set of rules used by the scheduler to determine where a pod can be placed</p>
</blockquote>
<p>There are currently two types of node affinity:</p>
<ul>
<li>
<p><code>requiredDuringSchedulingIgnoredDuringExecution</code>: Schedule the pod only on the nodes that match the nodeSelector. If no such nodes are available, the scheduler will not schedule the pod on nodes. If the pod is already scheduled on a node, the scheduler will ignore the nodeSelector.</p>
</li>
<li>
<p><code>preferredDuringSchedulingIgnoredDuringExecution</code>: Preference is given for the node that matches the expression but if no such nodes are available, the scheduler will schedule the pod in any available node. If the pod is already scheduled on a node, the scheduler will ignore the nodeSelector.</p>
</li>
</ul>
<p>Example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>with-node-affinity</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>affinity</span>:
    <span style=color:#f92672>nodeAffinity</span>:
      <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
        <span style=color:#f92672>nodeSelectorTerms</span>:
        - <span style=color:#f92672>matchExpressions</span>:
          - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>size</span>
            <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
            <span style=color:#f92672>values</span>:
            - <span style=color:#ae81ff>t1.large</span>
            - <span style=color:#ae81ff>t1.medium</span>
  <span style=color:#f92672>containers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>with-node-affinity</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>k8s.gcr.io/pause:2.0</span>
</code></pre></div>
</div>
</article>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/thoughts>Thoughts</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>